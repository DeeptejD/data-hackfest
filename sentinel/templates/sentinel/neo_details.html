{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ neo.name }} - Specimen Analysis Chamber</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        "space-black": "#0a0a0f",
                        "space-gray": "#1a1a2e",
                        "space-blue": "#16213e",
                        "cosmic-purple": "#6366f1",
                        "stellar-cyan": "#06b6d4",
                        "neon-green": "#39ff14",
                        "electric-blue": "#00ffff",
                        "hot-pink": "#ff1493",
                    },
                },
            },
        };
    </script>
    <style>
        @import url("https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Space+Mono:wght@400;700&display=swap");

        /* Hand-drawn pencil border effect */
        .sketch-border {
            position: relative;
            border: none;
        }

        .sketch-border::before {
            content: "";
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: transparent;
            border: 2px solid #39ff14;
            border-radius: 15px;
            filter: url(#roughen);
            animation: sketch-glow 3s ease-in-out infinite alternate;
            pointer-events: none; /* Allow mouse events to pass through */
            z-index: -1; /* Place behind content */
        }

        .sketch-border-purple::before {
            border-color: #ff1493;
            pointer-events: none;
            z-index: -1;
        }

        .sketch-border-cyan::before {
            border-color: #00ffff;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes sketch-glow {
            0% {
                filter: drop-shadow(0 0 5px currentColor);
                transform: rotate(-0.5deg);
            }

            100% {
                filter: drop-shadow(0 0 15px currentColor);
                transform: rotate(0.5deg);
            }
        }

        /* Science lab notebook lines */
        .lab-notes {
            background-image: linear-gradient(90deg, #ff1493 0%, transparent 1%),
                linear-gradient(0deg, rgba(57, 255, 20, 0.1) 0%, transparent 1%);
            background-size: 20px 20px;
        }

        /* Retro CRT screen effect */
        .crt-screen {
            background: linear-gradient(180deg,
                    transparent 50%,
                    rgba(0, 255, 255, 0.03) 50%);
            background-size: 100% 4px;
            animation: crt-flicker 0.15s infinite linear;
        }

        @keyframes crt-flicker {
            0% {
                opacity: 1;
            }

            98% {
                opacity: 1;
            }

            99% {
                opacity: 0.98;
            }

            100% {
                opacity: 1;
            }
        }

        /* Smooth hover transitions */
        .smooth-hover {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .smooth-hover:hover {
            transform: scale(1.03) rotate(1deg);
        }

        /* Cool holographic text effect */
        .holo-text {
            background: linear-gradient(45deg, #39ff14, #00ffff, #ff1493, #6366f1);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: holo-shift 3s ease-in-out infinite;
        }

        /* Custom scrollbar styling for chat */
        #chatMessages {
            scrollbar-width: thin;
            scrollbar-color: #39ff14 #1a1a2e;
        }

        #chatMessages::-webkit-scrollbar {
            width: 8px;
        }

        #chatMessages::-webkit-scrollbar-track {
            background: #1a1a2e;
            border-radius: 4px;
        }

        #chatMessages::-webkit-scrollbar-thumb {
            background: #39ff14;
            border-radius: 4px;
        }

        #chatMessages::-webkit-scrollbar-thumb:hover {
            background: #00ffff;
        }

        @keyframes holo-shift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        /* Space background for specimen chamber */
        .space-bg {
            background: radial-gradient(ellipse at center,
                    #2d1b69 0%,
                    #0f0c29 30%,
                    #000000 70%);
            position: relative;
            overflow: hidden;
        }

        .space-bg::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: radial-gradient(1px 1px at 20px 30px,
                    white,
                    transparent),
                radial-gradient(1px 1px at 40px 70px, white, transparent),
                radial-gradient(2px 2px at 90px 40px, white, transparent),
                radial-gradient(1px 1px at 130px 80px, white, transparent),
                radial-gradient(2px 2px at 160px 30px, white, transparent);
            background-repeat: repeat;
            background-size: 250px 120px;
            animation: twinkle 8s ease-in-out infinite alternate;
            opacity: 0.6;
        }

        @keyframes twinkle {
            0% {
                opacity: 0.3;
            }

            100% {
                opacity: 0.8;
            }
        }
        
        /* Floating rotating duck for chat */
        .floating-duck {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 100px;
            height: 100px;
            background: rgba(135, 206, 250, 0.15);
            border-radius: 50%;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 8px 32px rgba(135, 206, 250, 0.3), inset 0 2px 10px rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid rgba(173, 216, 230, 0.8);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
        }
        
        .floating-duck:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 48px rgba(135, 206, 250, 0.5), inset 0 2px 15px rgba(255, 255, 255, 0.2);
            border-color: rgba(173, 216, 230, 1);
        }
        
        .duck-image {
            width: 70px;
            height: 70px;
            object-fit: contain;
            animation: rotate360 8s linear infinite;
        }
        
        @keyframes rotate360 {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .floating-duck {
                right: 20px;
                bottom: 20px;
                width: 85px;
                height: 85px;
            }
            .duck-image {
                width: 55px;
                height: 55px;
            }
            #chatWindow {
                bottom: 28 !important;
                right: 2 !important;
                width: 90vw !important;
                max-width: 350px !important;
            }
        }
    </style>

    <!-- SVG Filters for rough pencil effect -->
    <svg style="position: absolute; width: 0; height: 0">
        <defs>
            <filter id="roughen">
                <feTurbulence baseFrequency="0.04" numOctaves="3" result="noise" seed="1" />
                <feDisplacementMap in="SourceGraphic" in2="noise" scale="2" />
            </filter>
        </defs>
    </svg>
</head>

<body class="bg-space-black min-h-screen crt-screen lab-notes" style="font-family: 'Space Mono', monospace">
    <!-- Cool Navigation Lab Style -->
    <nav class="bg-space-gray relative overflow-hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center space-x-8">
                    <!-- Cool logo -->
                    <div class="flex items-center space-x-3">
                        <h1 class="text-2xl font-black holo-text" style="font-family: 'Orbitron', monospace">
                            COSMODEX
                        </h1>
                    </div>

                    <!-- Navigation Links -->
                    <div class="hidden md:flex space-x-8">
                        <a href="/"
                            class="text-gray-300 hover:text-neon-green smooth-hover transition-colors duration-200 font-bold relative group">
                            Home
                            <span
                                class="absolute -bottom-1 left-0 w-0 h-0.5 bg-neon-green group-hover:w-full transition-all duration-300"></span>
                        </a>
                        <a href="/neos" class="text-electric-blue font-black relative smooth-hover">
                            NEOs
                            <span class="absolute -bottom-1 left-0 w-full h-0.5 bg-electric-blue"></span>
                        </a>
                        <a href="/neos/favorites"
                            class="text-gray-300 hover:text-hot-pink smooth-hover transition-colors duration-200 font-bold relative group">
                            Favorites
                            <span
                                class="absolute -bottom-1 left-0 w-0 h-0.5 bg-hot-pink group-hover:w-full transition-all duration-300"></span>
                        </a>
                        <a href="/profile"
                            class="text-gray-300 hover:text-cosmic-purple smooth-hover transition-colors duration-200 font-bold relative group">
                            Profile
                            <span
                                class="absolute -bottom-1 left-0 w-0 h-0.5 bg-cosmic-purple group-hover:w-full transition-all duration-300"></span>
                        </a>
                    </div>
                </div>

                <!-- User Info -->
                <div class="flex items-center space-x-4">
                    <div class="text-neon-green font-bold">{{ user.name }}</div>
                    <a href="/logout"
                        class="text-red-400 hover:text-red-300 smooth-hover transition-colors duration-200 font-bold">
                        Logout
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- SPECIMEN ANALYSIS CHAMBER -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <!-- Lab Header Section -->
        <section class="relative py-12 overflow-hidden">
            <div class="space-bg p-8 rounded-3xl relative">
                <div class="text-center relative z-10">
                    <!-- Back Button -->
                    <div class="mb-6">
                        <a href="/neos"
                            class="inline-flex items-center text-electric-blue hover:text-neon-green smooth-hover font-bold transition-colors duration-300 bg-space-black bg-opacity-50 px-4 py-2 rounded-xl">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                            </svg>
                            RETURN TO SPECIMEN VAULT
                        </a>
                    </div>

                    <!-- Main Title -->
                    <h1 class="text-5xl font-black mb-4 holo-text" style="font-family: 'Orbitron', monospace">
                        SPECIMEN ANALYSIS
                    </h1>
                    <div class="text-3xl text-white font-bold mb-2">
                        <span class="text-neon-green">SUBJECT:</span>
                        <span class="text-electric-blue">{{ neo.name }}</span>
                    </div>
                    <p class="text-lg text-gray-300 max-w-2xl mx-auto">
                        This cosmic specimen is ready for investigation!
                    </p>

                    <!-- Favorite Button in Header -->
                    <div class="mt-6">
                        {% if is_favorited %}
                        <form action="/unfavorite/" method="post" class="inline-block">
                            {% csrf_token %}
                            <input type="hidden" name="name" value="{{ neo.name }}" />
                            <button type="submit" title="Remove from collection"
                                class="bg-hot-pink bg-opacity-80 hover:bg-opacity-60 text-white px-6 py-3 rounded-xl font-black smooth-hover transition-all duration-500 border-2 border-hot-pink">
                                <svg class="w-5 h-5 inline-block mr-2" fill="currentColor" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3"
                                        d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z">
                                    </path>
                                </svg>
                                REMOVE FROM COLLECTION
                            </button>
                        </form>
                        {% else %}
                        <form action="/save_favorite/" method="post" class="inline-block">
                            {% csrf_token %}
                            <input type="hidden" name="name" value="{{ neo.name }}" />
                            <input type="hidden" name="diameter" value="{{ neo.diameter }}" />
                            <input type="hidden" name="speed" value="{{ neo.speed }}" />
                            <input type="hidden" name="miss_distance" value="{{ neo.miss_distance }}" />
                            <input type="hidden" name="date" value="{{ neo.date }}" />
                            <button type="submit" title="Add specimen to collection"
                                class="bg-hot-pink hover:bg-neon-green text-white px-6 py-3 rounded-xl font-black smooth-hover transition-all duration-500 border-2 border-electric-blue hover:border-hot-pink">
                                <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3"
                                        d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z">
                                    </path>
                                </svg>
                                ADD TO COLLECTION
                            </button>
                        </form>
                        {% endif %}
                    </div>
                </div>
            </div>
        </section>

        <div class="grid lg:grid-cols-3 gap-8 mt-12">
            <!-- Main Analysis Report -->
            <div class="lg:col-span-2">
                <!-- Specimen Data Header -->
                <div class="sketch-border bg-space-gray rounded-2xl p-8 mb-8 smooth-hover">
                    <div class="text-center mb-6">
                        <div class="text-sm text-electric-blue font-bold mb-2">
                            SPECIMEN DESIGNATION
                        </div>
                        <h2 class="text-3xl font-black text-white mb-2" style="font-family: 'Orbitron', monospace">
                            {{ neo.name }}
                        </h2>
                        <div class="text-neon-green font-bold">
                            STATUS: ACTIVE TRACKING
                        </div>
                    </div>

                    <!-- AI Summary Section -->
                    <div class="bg-space-black p-6 rounded-xl border-2 border-hot-pink border-opacity-30">
                        <h3 class="text-xl font-black text-hot-pink mb-4">
                            QUACKSTRONAUT'S ANALYSIS REPORT
                        </h3>
                        <div class="text-gray-300 leading-relaxed" id="summaryContent">
                            <div class="flex items-center space-x-3">
                                <div class="animate-spin rounded-full h-5 w-5 border-2 border-hot-pink border-t-transparent"></div>
                                <span>ü¶Ü Quackstronaut is analyzing this specimen...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lab Data Analysis Grid -->
                <div class="grid md:grid-cols-2 gap-6 mb-8">
                    <!-- Size Analysis -->
                    <div class="sketch-border bg-space-gray rounded-xl p-6 smooth-hover">
                        <div class="flex items-center mb-4">
                            <!-- <div
                                class="w-12 h-12 bg-neon-green bg-opacity-20 rounded-full flex items-center justify-center mr-4 border-2 border-neon-green">
                                <span class="text-2xl">ÔøΩ</span>
                            </div> -->
                            <div>
                                <h3 class="text-lg font-black text-neon-green">
                                    DIAMETER ANALYSIS
                                </h3>
                                <p class="text-gray-400 text-sm">Specimen size measurement</p>
                            </div>
                        </div>
                        <p class="text-4xl font-black text-neon-green mb-3">
                            {{ neo.diameter }}m
                        </p>
                        <div class="bg-space-black p-3 rounded-lg border border-neon-green border-opacity-30">
                            <p class="text-gray-300 text-sm" id="sizeDescription">
                                
                            </p>
                        </div>
                    </div>

                    <!-- Velocity Analysis -->
                    <div class="sketch-border sketch-border-purple bg-space-gray rounded-xl p-6 smooth-hover">
                        <div class="flex items-center mb-4">
                            <!-- <div
                                class="w-12 h-12 bg-hot-pink bg-opacity-20 rounded-full flex items-center justify-center mr-4 border-2 border-hot-pink">
                                <span class="text-2xl">‚ö°</span>
                            </div> -->
                            <div>
                                <h3 class="text-lg font-black text-hot-pink">
                                    VELOCITY ANALYSIS
                                </h3>
                                <p class="text-gray-400 text-sm">Speed through space-time</p>
                            </div>
                        </div>
                        <p class="text-4xl font-black text-hot-pink mb-3">
                            {{ neo.speed }} km/s
                        </p>
                        <div class="bg-space-black p-3 rounded-lg border border-hot-pink border-opacity-30">
                            <p class="text-gray-300 text-sm" id="speedDescription">
                                
                            </p>
                        </div>
                    </div>

                    <!-- Distance Analysis -->
                    <div class="sketch-border sketch-border-cyan bg-space-gray rounded-xl p-6 smooth-hover">
                        <div class="flex items-center mb-4">
                            <div
                                class="w-12 h-12 bg-electric-blue bg-opacity-20 rounded-full flex items-center justify-center mr-4 border-2 border-electric-blue">
                                <span class="text-2xl">üåç</span>
                            </div>
                            <div>
                                <h3 class="text-lg font-black text-electric-blue">
                                    PROXIMITY ANALYSIS
                                </h3>
                                <p class="text-gray-400 text-sm">Safe distance measurement</p>
                            </div>
                        </div>
                        <p class="text-4xl font-black text-electric-blue mb-3">
                            {{ neo.miss_distance }} LD
                        </p>
                        <div class="bg-space-black p-3 rounded-lg border border-electric-blue border-opacity-30">
                            <p class="text-gray-300 text-sm" id="distanceDescription">
                                
                            </p>
                        </div>
                    </div>

                    <!-- Temporal Analysis -->
                    <div class="sketch-border bg-space-gray rounded-xl p-6 smooth-hover">
                        <div class="flex items-center mb-4">
                            <div
                                class="w-12 h-12 bg-stellar-cyan bg-opacity-20 rounded-full flex items-center justify-center mr-4 border-2 border-stellar-cyan">
                                <span class="text-2xl">üìÖ</span>
                            </div>
                            <div>
                                <h3 class="text-lg font-black text-stellar-cyan">
                                    ENCOUNTER TIMELINE
                                </h3>
                                <p class="text-gray-400 text-sm">
                                    Optimal observation window
                                </p>
                            </div>
                        </div>
                        <p class="text-2xl font-black text-stellar-cyan mb-3">
                            {{ neo.date }}
                        </p>
                        <div class="bg-space-black p-3 rounded-lg border border-stellar-cyan border-opacity-30">
                            <p class="text-gray-300 text-sm" id="dateDescription">
                                
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Lab Research Sidebar -->
            <div class="space-y-6">
                <!-- Research Notes -->
                <div class="sketch-border sketch-border-purple bg-space-gray rounded-xl p-6 smooth-hover">
                    <h3 class="text-xl font-black text-hot-pink mb-4" style="font-family: 'Orbitron', monospace">
                        RESEARCH NOTES
                    </h3>
                    <div class="space-y-4 text-sm">
                        <div
                            class="flex items-start bg-space-black p-3 rounded-lg border border-neon-green border-opacity-30">
                            <span class="text-2xl mr-3">üåü</span>
                            <div>
                                <p class="text-neon-green font-bold">
                                    Ancient Cosmic Artifacts!
                                </p>
                                <p class="text-gray-300">
                                    These specimens are 4.6 billion year old remnants from our
                                    solar system's formation!
                                </p>
                            </div>
                        </div>
                        <div
                            class="flex items-start bg-space-black p-3 rounded-lg border border-hot-pink border-opacity-30">
                            <span class="text-2xl mr-3">üöÄ</span>
                            <div>
                                <p class="text-hot-pink font-bold">Incredible Velocities!</p>
                                <p class="text-gray-300">
                                    Moving at speeds up to 25 km/s - that's 90,000 km per hour
                                    through space!
                                </p>
                            </div>
                        </div>
                        <div
                            class="flex items-start bg-space-black p-3 rounded-lg border border-electric-blue border-opacity-30">
                            <span class="text-2xl mr-3">üõ°Ô∏è</span>
                            <div>
                                <p class="text-electric-blue font-bold">
                                    Earth Protection Protocol!
                                </p>
                                <p class="text-gray-300">
                                    Over 25,000 Near-Earth Objects are tracked continuously for
                                    planetary safety!
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lab Navigation -->
                <div class="space-y-4">
                    <a href="/neos"
                        class="block w-full bg-gradient-to-r from-cosmic-purple to-hot-pink hover:from-hot-pink hover:to-electric-blue text-white py-4 px-6 rounded-xl font-black text-center smooth-hover transition-all duration-500">
                        RETURN TO MORE ROCKS
                    </a>
                    <a href="/neos/favorites"
                        class="block w-full bg-gradient-to-r from-neon-green to-electric-blue hover:from-electric-blue hover:to-stellar-cyan text-black hover:text-white py-4 px-6 rounded-xl font-black text-center smooth-hover transition-all duration-500">
                        MY SPECIMEN COLLECTION
                    </a>
                </div>

                <!-- Safety Protocol Badge -->
                <div class="sketch-border sketch-border-cyan bg-space-gray rounded-xl p-4 smooth-hover">
                    <div class="text-center">
                        <div
                            class="w-16 h-16 bg-electric-blue bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-3 border-2 border-electric-blue">
                            <span class="text-3xl">üõ°Ô∏è</span>
                        </div>
                        <h4 class="text-electric-blue font-black mb-2">
                            EARTH PROTECTION ACTIVE
                        </h4>
                        <p class="text-gray-300 text-sm">
                            All specimens maintain safe trajectories. No threat detected to
                            planetary systems!
                        </p>
                        <div class="mt-3 bg-electric-blue bg-opacity-10 p-2 rounded-lg">
                            <div class="text-electric-blue font-bold text-xs">
                                STATUS: SECURE
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- QUACKSTRONAUT AI ASSISTANT -->
    <div class="fixed bottom-2 right-2 z-50">
        <!-- Floating Duck Chat Toggle -->
        <div id="chatToggle" class="floating-duck cursor-pointer">
            <img src="{% static 'sentinel/images/quackstronaut.png' %}" 
                 alt="Quackstronaut" 
                 class="duck-image">
        </div>

        <!-- Chat Window -->
        <div id="chatWindow"
            class="hidden absolute bottom-32 right-4 w-96 sm:w-96 sketch-border bg-space-gray rounded-2xl shadow-2xl z-10">
            <!-- Chat Header -->
            <div class="space-bg p-4 rounded-t-xl relative z-20">
                <div class="flex items-center justify-between relative z-10">
                    <div class="flex items-center space-x-3">
                        <div>
                            <h3 class="text-white font-black" style="font-family: 'Orbitron', monospace">
                                QUACKSTRONAUT
                            </h3>
                            <p class="text-electric-blue text-sm font-bold">
                                AI SPACE COMPANION
                            </p>
                        </div>
                    </div>
                    <button id="chatClose" class="text-white hover:text-hot-pink smooth-hover transition-colors relative z-30"
                        title="Close chat">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Chat Messages -->
            <div id="chatMessages" class="h-80 overflow-y-auto p-4 space-y-4 bg-space-black rounded-none relative z-20">
                <!-- Initial Quackstronaut Message -->
                <div class="flex items-start space-x-3">
                    <div class="bg-space-gray border border-neon-green border-opacity-50 rounded-lg p-3 max-w-xs">
                        <p class="text-white text-sm font-bold">
                            Quack! Greetings, space explorer! üöÄ I'm Quackstronaut, your
                            friendly AI space companion ready to help you discover the
                            wonders of {{ neo.name }}! *quack Ask me anything about this amazing
                            asteroid! *quack
                        </p>
                    </div>
                </div>
            </div>

            <!-- Chat Input -->
            <div class="p-4 border-t-2 border-neon-green bg-space-gray rounded-b-xl relative z-20">
                <form id="chatForm" class="flex space-x-2">
                    {% csrf_token %}
                    <input type="hidden" name="name" value="{{ neo.name }}" />
                    <input type="hidden" name="diameter" value="{{ neo.diameter }}" />
                    <input type="hidden" name="speed" value="{{ neo.speed }}" />
                    <input type="hidden" name="miss_distance" value="{{ neo.miss_distance }}" />
                    <input type="hidden" name="date" value="{{ neo.date }}" />
                    <input type="text" id="chatInput" name="question"
                        placeholder="Ask Quackstronaut about {{ neo.name }}..."
                        class="flex-1 bg-space-black border-2 border-electric-blue rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-neon-green smooth-hover relative z-30"
                        maxlength="200" />
                    <button type="submit" title="Send message"
                        class="bg-gradient-to-r from-neon-green to-electric-blue hover:from-hot-pink hover:to-neon-green text-black hover:text-white px-4 py-2 rounded-lg font-bold smooth-hover transition-all duration-500 relative z-30">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                        </svg>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Async content loading
        document.addEventListener('DOMContentLoaded', function() {
            loadNeoSummary();
            loadNeoDescriptions();
        });

        async function loadNeoSummary() {
            try {
                const neoData = {
                    name: '{{ neo.name|escapejs }}',
                    diameter: '{{ neo.diameter|escapejs }}',
                    speed: '{{ neo.speed|escapejs }}',
                    miss_distance: '{{ neo.miss_distance|escapejs }}',
                    date: '{{ neo.date|escapejs }}'
                };
                
                const response = await fetch('/api/neo-summary/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                    },
                    body: new URLSearchParams(neoData)
                });

                const data = await response.json();
                
                const summaryElement = document.getElementById('summaryContent');
                if (data.success && data.summary) {
                    summaryElement.innerHTML = `
                        <p class="text-white text-sm mb-4 leading-relaxed font-light">
                            ${data.summary}
                        </p>
                    `;
                } else {
                    summaryElement.innerHTML = `
                        <p class="text-neon-green text-sm mb-4 leading-relaxed font-light">
                            üî¨ Analysis systems temporarily offline! Our quack team is working on it!
                        </p>
                    `;
                }
            } catch (error) {
                console.error('Error loading summary:', error);
                document.getElementById('summaryContent').innerHTML = `
                    <p class="text-hot-pink text-sm mb-4 leading-relaxed font-light">
                        üì° Communication error! Please refresh to retry analysis!
                    </p>
                `;
            }
        }

        async function loadNeoDescriptions() {
            try {
                const neoData = {
                    name: '{{ neo.name|escapejs }}',
                    diameter: '{{ neo.diameter|escapejs }}',
                    speed: '{{ neo.speed|escapejs }}',
                    miss_distance: '{{ neo.miss_distance|escapejs }}',
                    date: '{{ neo.date|escapejs }}'
                };
                
                const response = await fetch('/api/neo-descriptions/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                    },
                    body: new URLSearchParams(neoData)
                });

                const data = await response.json();
                
                if (data.success && data.descriptions) {
                    // Update size description
                    const sizeElement = document.getElementById('sizeDescription');
                    if (data.descriptions.size) {
                        sizeElement.innerHTML = data.descriptions.size;
                        sizeElement.className = "text-white text-sm leading-relaxed font-light";
                    } else {
                        sizeElement.innerHTML = 'üî¨ Size analysis pending...';
                        sizeElement.className = "text-neon-green text-sm";
                    }

                    // Update speed description
                    const speedElement = document.getElementById('speedDescription');
                    if (data.descriptions.speed) {
                        speedElement.innerHTML = data.descriptions.speed;
                        speedElement.className = "text-white text-sm leading-relaxed font-light";
                    } else {
                        speedElement.innerHTML = '‚ö° Velocity analysis pending...';
                        speedElement.className = "text-neon-green text-sm";
                    }

                    // Update distance description
                    const distanceElement = document.getElementById('distanceDescription');
                    if (data.descriptions.distance) {
                        distanceElement.innerHTML = data.descriptions.distance;
                        distanceElement.className = "text-white text-sm leading-relaxed font-light";
                    } else {
                        distanceElement.innerHTML = 'üìè Distance analysis pending...';
                        distanceElement.className = "text-electric-blue text-sm";
                    }

                    // Update date description
                    const dateElement = document.getElementById('dateDescription');
                    if (data.descriptions.date) {
                        dateElement.innerHTML = data.descriptions.date;
                        dateElement.className = "text-white text-sm leading-relaxed font-light";
                    } else {
                        dateElement.innerHTML = 'üìÖ Temporal analysis pending...';
                        dateElement.className = "text-stellar-cyan text-sm";
                    }
                } else {
                    // Handle error for all descriptions
                    const errorMsg = 'üî¨ Analysis systems offline! Retry needed!';
                    const elements = [
                        'sizeDescription', 'speedDescription', 'distanceDescription', 'dateDescription'
                    ];
                    elements.forEach(id => {
                        const element = document.getElementById(id);
                        element.innerHTML = errorMsg;
                        element.className = "text-neon-green text-sm";
                    });
                }
            } catch (error) {
                console.error('Error loading descriptions:', error);
                const errorMsg = 'üì° Communication error! Refresh to retry!';
                const elements = [
                    'sizeDescription', 'speedDescription', 'distanceDescription', 'dateDescription'
                ];
                elements.forEach(id => {
                    const element = document.getElementById(id);
                    element.innerHTML = errorMsg;
                    element.className = "text-hot-pink text-sm";
                });
            }
        }

        // Chat functionality
        const chatToggle = document.getElementById("chatToggle");
        const chatWindow = document.getElementById("chatWindow");
        const chatClose = document.getElementById("chatClose");
        const chatForm = document.getElementById("chatForm");
        const chatInput = document.getElementById("chatInput");
        const chatMessages = document.getElementById("chatMessages");

        // Toggle chat window with smooth animation
        chatToggle.addEventListener("click", () => {
            chatWindow.classList.toggle("hidden");
        });

        chatClose.addEventListener("click", () => {
            chatWindow.classList.add("hidden");
        });

        // Handle chat form submission
        chatForm.addEventListener("submit", async (e) => {
            e.preventDefault();

            const question = chatInput.value.trim();
            if (!question) return;

            // Add user message to chat
            addMessage(question, "user");
            chatInput.value = "";

            // Add loading message
            const loadingDiv = addMessage(
                "Quackstronaut is analyzing data... üî¨",
                "quackstronaut",
                true
            );

            try {
                const formData = new FormData(chatForm);
                formData.set("question", question);

                const response = await fetch("/chat-quackstronaut/", {
                    method: "POST",
                    body: formData,
                });

                const data = await response.json();

                // Remove loading message
                chatMessages.removeChild(loadingDiv);

                if (data.success) {
                    addMessage(data.response, "quackstronaut");
                } else {
                    addMessage(
                        "Lab systems experiencing interference! Please try another inquiry! üöÄ",
                        "quackstronaut"
                    );
                }
            } catch (error) {
                // Remove loading message
                if (chatMessages.contains(loadingDiv)) {
                    chatMessages.removeChild(loadingDiv);
                }
                addMessage(
                    "Communication array malfunction! Attempting to reconnect... üõ∏",
                    "quackstronaut"
                );
            }
        });

        function addMessage(text, sender, isLoading = false) {
            const messageDiv = document.createElement("div");
            messageDiv.className = "flex items-start space-x-3";

            if (sender === "user") {
                messageDiv.innerHTML = `
                    <div class="flex-1"></div>
                    <div class="bg-hot-pink border border-electric-blue border-opacity-50 rounded-lg p-3 max-w-xs">
                        <p class="text-white text-sm font-bold">${text}</p>
                    </div>
                    <div class="w-8 h-8 bg-electric-blue rounded-full flex items-center justify-center flex-shrink-0 border border-neon-green">
                        <span class="text-black text-sm font-bold">üë®‚ÄçüöÄ</span>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="w-8 h-8 bg-neon-green rounded-full flex items-center justify-center flex-shrink-0 border border-electric-blue">
                        <span class="text-black text-sm font-bold">ÔøΩ</span>
                    </div>
                    <div class="bg-space-gray border border-neon-green border-opacity-50 rounded-lg p-3 max-w-xs ${isLoading ? "animate-pulse" : ""
                    }">
                        <p class="text-white text-sm font-bold">${text}</p>
                    </div>
                `;
            }

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return messageDiv;
        }

        // Add smooth hover effects to all interactive elements
        document.querySelectorAll(".smooth-hover").forEach((element) => {
            element.addEventListener("mouseenter", function () {
                this.style.transition = "all 0.5s cubic-bezier(0.4, 0, 0.2, 1)";
            });
        });

        // Smooth hover effects for sketch borders
        document.querySelectorAll(".sketch-border").forEach((card) => {
            card.addEventListener("mouseenter", function () {
                this.style.transition = "transform 0.6s cubic-bezier(0.4, 0, 0.2, 1)";
                this.style.transform =
                    "scale(1.02) rotate(" + (Math.random() * 0.5 - 0.25) + "deg)";
            });

            card.addEventListener("mouseleave", function () {
                this.style.transition = "transform 0.6s cubic-bezier(0.4, 0, 0.2, 1)";
                this.style.transform = "scale(1) rotate(0deg)";
            });
        });

        // Holographic text glitch effect
        setInterval(() => {
            const titles = document.querySelectorAll(".holo-text");
            titles.forEach((title) => {
                if (Math.random() < 0.1) {
                    title.style.transition = "text-shadow 0.3s ease-in-out";
                    title.style.textShadow = "2px 2px #ff1493, -2px -2px #00ffff";
                    setTimeout(() => {
                        title.style.textShadow = "none";
                    }, 200);
                }
            });
        }, 3000);

        // Smooth button hover effects
        document.querySelectorAll("button, a").forEach((element) => {
            element.addEventListener("mouseenter", function () {
                this.style.transition = "all 0.5s ease-in-out";
            });
        });
    </script>
</body>

</html>